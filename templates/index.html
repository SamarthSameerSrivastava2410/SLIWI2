<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hand Gesture Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white">

<div class="min-h-full">

  <!-- NAVBAR -->
  <nav class="bg-gray-800/50">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex h-16 items-center justify-between">
        <div class="flex items-center">
           <img class="h-12 w-auto object-contain" src="/static/cipherlogo.png" alt="Hand Gesture Logo">
           <span class="ml-4 text-xl font-bold tracking-tight">Cipher</span>
        </div>
        <div class="flex items-center space-x-4">
          <a href="/" class="text-white hover:text-gray-300">Translator</a>
          <a href="/hand-gestures" class="text-white hover:text-gray-300">Hand Gestures</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- HEADER -->
  <header class="bg-gray-800 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
      <h1 class="text-3xl font-bold tracking-tight">Hand Gesture Recognition</h1>
    </div>
  </header>

  <!-- MAIN -->
  <main id="page-content">
    <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">

      <!-- FLEX CONTAINER -->
      <div class="flex flex-col md:flex-row gap-6">

        <!-- CAMERA CARD -->
        <div class="bg-gray-800 rounded-xl p-6 shadow-lg flex-shrink-0 md:w-2/3">
          <h2 class="text-xl font-semibold mb-4">Live Camera Feed</h2>
          <div class="flex justify-center">
            <!-- Video stream from Flask app -->
            <img id="video-stream" src="/video_feed" class="rounded-lg border border-gray-700 w-full h-auto max-h-[600px]" alt="Live video feed">
          </div>
        </div>

        <!-- TRANSLATED OUTPUT CARD -->
        <div class="bg-gray-800 rounded-xl p-6 shadow-lg md:w-1/3">
          <h2 class="text-xl font-semibold mb-4">Translated Output</h2>

          <!-- Single textarea for all gestures -->
          <textarea id="output" placeholder="Translated text will appear here..." class="w-full h-[500px] rounded-lg p-4 bg-gray-900 text-white resize-none" readonly></textarea>
        </div>

      </div>

    </div>
  </main>

</div>

<script>
let lastStaticLabel = "";
let lastStaticTime = 0;
const recognitionDelay = 3; // seconds between recognizing same label
let typingQueue = [];
let isTyping = false;

function typeFromQueue() {
    if (isTyping || typingQueue.length === 0) return;
    isTyping = true;

    const textarea = document.getElementById('output');
    let text = typingQueue.shift();
    let i = 0;

    const interval = setInterval(() => {
        if (i < text.length) {
            textarea.value += text[i];
            i++;
        } else {
            clearInterval(interval);
            isTyping = false;
            typeFromQueue(); // start next in queue if any
        }
    }, 100); // 100ms per character
}

setInterval(() => {
    fetch('/get_current_labels')
        .then(res => res.json())
        .then(data => {
            const staticLabel = data.static || "";
            const currentTime = Date.now() / 1000;

            // ---------- STATIC LABEL ----------
            if (staticLabel && (staticLabel !== lastStaticLabel) && (currentTime - lastStaticTime >= recognitionDelay)) {
                typingQueue.push(staticLabel);
                lastStaticLabel = staticLabel;
                lastStaticTime = currentTime;
            }

            // Start typing
            typeFromQueue();

        })
        .catch(err => console.error(err));
}, 500);
</script>





</body>
</html>
